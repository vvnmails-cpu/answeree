<script>
  const archiveList = document.getElementById('archive-list');
  const digestContainer = document.getElementById('digest-container');

  async function loadArchiveList() {
    try {
      const res = await fetch('data/archive_index.json');
      const dates = await res.json();

      if (!dates.length) {
        archiveList.innerHTML = "<p style='text-align:center;'>No past digests found.</p>";
        return;
      }

      archiveList.innerHTML = "<h2>Select a Date</h2>";
      dates.forEach(date => {
        const item = document.createElement('div');
        item.className = 'archive-item';
        item.textContent = date;
        item.onclick = () => loadDigest(date);
        archiveList.appendChild(item);
      });
    } catch (err) {
      console.error(err);
      archiveList.innerHTML = "<p style='color:red;text-align:center;'>⚠️ Failed to load archive list.</p>";
    }
  }

  async function loadDigest(date) {
    digestContainer.innerHTML = '<p style="text-align:center;">Loading...</p>';
    try {
      const res = await fetch(`data/${date}.json`);
      const posts = await res.json();

      archiveList.style.display = 'none';
      digestContainer.innerHTML = `
        <a class="back-btn" href="#" onclick="resetView(event)">← Back</a>
      `;

      posts.forEach(post => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${post.title}</h3>
          <p>${post.summary}</p>
          <a href="${post.url}" target="_blank">Read more →</a>
        `;
        digestContainer.appendChild(card);
      });
    } catch (err) {
      digestContainer.innerHTML = '<p style="color:red;text-align:center;">Failed to load this digest.</p>';
    }
  }

  function resetView(event) {
    event.preventDefault();
    digestContainer.innerHTML = '';
    archiveList.style.display = 'block';
  }

  loadArchiveList();
</script>
